@* 
    @
    { ViewData["Title"] = "Home Page"; 
    }
<div class="text-center"> 
    <h1 class="display-4">Welcome</h1> 
    <p>Learn about <a href="https://learn.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p> 
    </div> *@


@using Souqna.Helpers
@using static Souqna.Data.Enums.ProductEnums
@using System.Linq
@model Souqna.Data.ViewModels.HomeVM
<section id="hero" class="hero section accent-background">

    <div class="container">
        <div class="row gy-4">
            <div class="col-lg-6 order-2 order-lg-1 d-flex flex-column justify-content-center">
                <h1>سوق سوريا للمستعمل-الجديد – كل شيء بسعر أحسن</h1>
                <p>مرحبًا بك في سوق سوريا للمستعمل-الجديد – مكانك الأول لبيع وشراء المنتجات المستعملة والجديدة بسهولة، أمان، وأسعار تناسب الجميع</p>
                <div class="d-flex">
                    <a href="#about" class="btn-get-started">انطلق نحو صفقات مميزة</a>
                </div>
            </div>
            <div class="col-lg-6 order-1 order-lg-2 hero-img">
                <img src="~/assets/img/market1.png" class="img-fluid animated" alt="">
            </div>
        </div>
    </div>

</section>




<!--********************************* البحث start ********************************* -->
<section id="productSearch" class="productSearch section">
    <div class="container mt-5 mb-5">
        <form asp-controller="Home" asp-action="ProductSearch" method="get">
            <div class="row">
                <input type="submit" class="col-sm-2 btn btn-primary" value="ابحث" />
                <div class="col-sm-10">
                    <input type="text" name="Sname" id="Sname" class="form-control" placeholder="البحث" />
                </div>
            </div>
        </form>
    </div>
</section>


<!--********************************* البحث end ********************************* -->

@* ********************************* المنتجات start ********************************* *@ 

<section id="portfolio" class="portfolio section">
    <div class="container section-title" data-aos="fade-up">
        <div>
            <h2>المنتجات</h2>
            <p>ابتكار، تنوع، وأناقة... كل ذلك بين يديك الآن.</p>
        </div>
        <div>
            @if (User.Identity.IsAuthenticated)
            {
                <a asp-controller="Product" asp-action="Create" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> إضافة منتج
                </a>
            }
            else
            {
                <a asp-area="Identity" asp-page="/Account/Login" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> إضافة منتج
                </a>
            }
        </div>
    </div>

    <div class="container">
        <div class="isotope-layout" data-default-filter="*" data-layout="masonry" data-sort="original-order">

            <!-- الفلاتر -->
            <ul class="portfolio-filters isotope-filters" data-aos="fade-up" data-aos-delay="100">
                <li data-filter="*" class="filter-active">الكل</li>
                @foreach (var category in Model.Categories)
                {
                    var filterClass = "filter-" + category.Name.Replace(" ", "").ToLower();
                    var categoryEnum = Enum.Parse<ProductCategory>(category.Name); // تحويل الاسم من string إلى enum

                    <li data-filter=".@filterClass">@categoryEnum.GetDisplayName()</li>
                }
            </ul>

            <!-- المنتجات -->
            <div id="productsContainer" class="row gy-4 isotope-container" data-aos="fade-up" data-aos-delay="200">
                @foreach (var category in Model.Categories)
                {
                    var filterClass = "filter-" + category.Name.Replace(" ", "").ToLower();

                    if (category.Products != null)
                    {
                        foreach (var product in category.Products)
                        {
                            var image = product.GetImages().FirstOrDefault() ?? "/images/no-image.png";

                            <div class="col-lg-3 col-md-4 col-sm-6 portfolio-item isotope-item @filterClass">
                                <div class="product-card shadow-sm rounded bg-white h-100 d-flex flex-column">
                                    <a asp-controller="Product" asp-action="Details" asp-route-id="@product.ProductId" class="image-link">
                                        <img src="@image" alt="@product.Name" class="product-image rounded-top" style="width:100%; height:250px; object-fit:cover;" />
                                    </a>

                                    <div class="product-info p-3 d-flex flex-column flex-grow-1">
                                        <h5 class="product-title mb-1">
                                            <a asp-controller="Product" asp-action="Details" asp-route-id="@product.ProductId" class="text-dark text-decoration-none">
                                                @product.Name
                                            </a>
                                        </h5>

                                        <p class="product-description text-muted small mb-2" style="height: 40px; overflow: hidden;">
                                            @product.StockQuantity
                                        </p>
                                        <p class="product-description text-muted small mb-2" style="height: 40px; overflow: hidden;">
                                            @product.Description
                                        </p>

                                        <div class="mt-auto d-flex justify-content-between align-items-center">
                                            <span class="text-success fw-bold">@product.PriceOfUnit.ToString("C")</span>
                                            <a asp-controller="Product" asp-action="Details" asp-route-id="@product.ProductId" class="btn btn-sm btn-outline-primary">
                                                التفاصيل
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                }
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        document.querySelector('form[asp-action="ProductSearch"]').addEventListener('submit', function (e) {
            e.preventDefault();
            const term = document.getElementById('Sname').value;
            fetch(`/Home/ProductSearch?Sname=${encodeURIComponent(term)}`, {
                headers: { "X-Requested-With": "XMLHttpRequest" }
            })
            .then(res => res.text())
            .then(html => {
                document.getElementById('productsContainer').innerHTML = html;
            });
        });
    </script>
}



<!-- /Portfolio Section -->
@* ********************************* المنتجات end ********************************* *@


<!--********************************* الفئات start ********************************* -->
<section id="services" class="services section">
    <div class="container section-title" data-aos="fade-up">
        <h2>الفئات</h2> <p>تصفح الفئات المتوفرة في السوق</p>
    </div>
    <!-- End Section Title -->
    <div class="container">
        <div class="row gy-4">
            @if (Model != null && Model.Categories != null && Model.Categories.Count > 0)
            {
                int delay = 100; foreach (var category in Model.Categories)
                {
                    var filterClass = "filter-" + category.Name.Replace(" ", " ").ToLower();
                    var categoryEnum = Enum.Parse<ProductCategory>(category.Name); // تحويل الاسم من string إلى enum

                    <div class="col-xl-4 col-lg-6" data-aos="fade-up" data-aos-delay="@delay">
                        <div class="service-item d-flex">
                            <div class="icon flex-shrink-0">
                                <i class="bi @category.Icon"></i>
                                <!-- ✅ عرض الأيقونة -->
                            </div>
                            <div>
                                <h4 class="title">
                                    <a href="#portfolio" class="stretched-link category-link" data-filter=".@filterClass">@categoryEnum.GetDisplayName()</a>
                                </h4> <p class="description">عدد السلع المتوفرة: @category.Products?.Count() </p>

                            </div>

                        </div>

                    </div>
                    delay += 100;
                }
            }
            else
            {
                <div class="col-12"> <div class="alert alert-info text-center"> لا توجد فئات حالياً. </div> </div>
            }
        </div>

    </div>


</section>

<!--********************************* الفئات end ********************************* -->




<!--********************************* احدث المنتجات Start ********************************* -->

<section id="latest-products" class="pricing section">
    <div class="container section-title" data-aos="fade-up">
        <h2>أحدث المنتجات</h2>
        <p>منتجات تم إضافتها مؤخراً — سارع بالشراء</p>
    </div>

    <div class="container">
        <div class="row gy-4">
            @foreach (var product in Model.LatestProducts)
            {
                var image = product.GetImages().FirstOrDefault() ?? "/images/no-image.png";

                <div class="col-lg-4 col-md-6" data-aos="zoom-in" data-aos-delay="200">
                    <div class="pricing-item featured h-100 d-flex flex-column shadow-sm rounded bg-white">
                        <a asp-controller="Product" asp-action="Details" asp-route-id="@product.ProductId">
                            <img src="@image" alt="@product.Name" class="product-image rounded-top" style="width:100%; height:250px; object-fit:cover;" />
                        </a>

                        <div class="product-info p-3 d-flex flex-column flex-grow-1">
                            <h5 class="product-title mb-1">
                                <a asp-controller="Product" asp-action="Details" asp-route-id="@product.ProductId" class="text-dark text-decoration-none">
                                    @product.Name
                                </a>
                            </h5>

                            <p class="text-muted small mb-2" style="height: 40px; overflow: hidden;">
                                @product.Description
                            </p>

                            <p class="text-muted small mb-2">
                                الكمية المتوفرة: @product.StockQuantity
                            </p>

                            <div class="mt-auto d-flex justify-content-between align-items-center">
                                <span class="text-success fw-bold">@product.PriceOfUnit.ToString("C")</span>
                                <a asp-controller="Product" asp-action="Details" asp-route-id="@product.ProductId" class="btn btn-sm btn-outline-primary">
                                    التفاصيل
                                </a>
                            </div>
                        </div>

                        <div class="mt-3 p-3">
                            <a asp-controller="Order"
                               asp-action="Checkout"
                               asp-route-productId="@product.ProductId"
                               class="btn btn-primary btn-lg w-100">
                                شراء الآن
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>



<!--********************************* احدث النتجات end ********************************* -->
<!--********************************* اراء العملاء start ********************************* -->
@if (Model.Reviews != null && Model.Reviews.Any(r => r.IsApproved))
{
    <!-- Testimonials Section -->
    <section id="testimonials" class="testimonials section light-background">

        <!-- Section Title -->
        <div class="container section-title" data-aos="fade-up">
            <h2>آراء العملاء</h2>
            <p>مستعدين دائمًا لتلبية احتياجاتكم</p>
        </div><!-- End Section Title -->

        <div class="container" data-aos="fade-up" data-aos-delay="100">

            <div class="swiper init-swiper"
                 data-speed="600"
                 data-delay="5000"
                 data-breakpoints="{ &quot;320&quot;: { &quot;slidesPerView&quot;: 1, &quot;spaceBetween&quot;: 40 }, &quot;1200&quot;: { &quot;slidesPerView&quot;: 3, &quot;spaceBetween&quot;: 20 } }">

                <script type="application/json" class="swiper-config">
                    {
                        "loop": true,
                        "speed": 600,
                        "autoplay": {
                            "delay": 5000
                        },
                        "slidesPerView": "auto",
                        "pagination": {
                            "el": ".swiper-pagination",
                            "type": "bullets",
                            "clickable": true
                        },
                        "breakpoints": {
                            "320": {
                                "slidesPerView": 1,
                                "spaceBetween": 40
                            },
                            "1200": {
                                "slidesPerView": 3,
                                "spaceBetween": 20
                            }
                        }
                    }
                </script>

                <div class="swiper-wrapper">
                    @foreach (var review in Model.Reviews.Where(r => r.IsApproved))
                    {
                        <div class="swiper-slide">
                            <div class="testimonial-item" style="border-radius:40px">
                                <p style="min-height:250px;">
                                    <i class="bi bi-quote quote-icon-left"></i>
                                    <span>@review.Description</span>
                                    <i class="bi bi-quote quote-icon-right"></i>
                                </p>

                                <img src="@(string.IsNullOrEmpty(review.User?.ProfileImage)
                                    ? Url.Content("~/images/default-user.png")
                                    : Url.Content("~" + review.User.ProfileImage))"
                                     class="testimonial-img"
                                     alt="@review.Name" />

                                <h3>@review.Name</h3>
                                <h4>@review.Subject</h4>
                            </div>
                        </div>
                    }
                </div>

                <div class="swiper-pagination"></div>
            </div>

        </div>

    </section>
}
else
{
    <div class="text-center p-4">
        <p class="text-muted">🚀 لا توجد آراء بعد — كن أول من يشارك رأيه!</p>
    </div>
}
<!--********************************* اراء العملاء end ********************************* -->















@*  ********************************* تواصل معنا  start ********************************* *@ 
 <section id="contact" class="contact section">
    <!-- Section Title -->
    <div class="container section-title" data-aos="fade-up">
        <h2>تواصل معنا</h2>
        <p>مستعدين دائما لاستقبال مقترحاتكم, نحن سعيدين بهذه الملاحظات</p>
    </div>

    <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row gy-4">

            <div class="col-lg-6">

                <div class="row gy-4">

                    <div class="col-md-6">
                        <div class="info-item" data-aos="fade" data-aos-delay="300">


                            <p>
                                <a href="https://api.whatsapp.com/send?phone=%2B905350724415" target="_blank">
                                    <i class="bi bi-telephone"></i>
                                </a>

                                <h3>اتصل بنا</h3>
                            </p>

                        </div>
                    </div><!-- End Info Item -->

                    <div class="col-md-6">
                        <div class="info-item" data-aos="fade" data-aos-delay="400">


                            <p>
                                <a href="mailto:anasmaari789@gmail.com" target="_blank"><i class="bi bi-envelope"></i></a>
                                <h3>رسالة بريد الكتروني</h3>
                            </p>
                        </div>
                    </div><!-- End Info Item -->


                    <div class="col-md-6">
                        <div class="info-item" data-aos="fade" data-aos-delay="200">
                            <i class="bi bi-geo-alt"></i>
                            <h3>العنوان</h3>
                            <p>ساحة الساعة</p>
                            <p>سوريا/ادلب</p>
                            <p class="Addres"><iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d807.6585596214227!2d36.63154712906397!3d35.9314518539491!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x152509a0b5468e6b%3A0xbb6b62cb4f5d1c69!2z2KXYr9mE2Kgg2K_ZiNin2LEg2KfZhNiz2KfYudip!5e0!3m2!1sar!2sbg!4v1753890593049!5m2!1sar!2sbg"></iframe></p>

                        </div>
                    </div><!-- End Info Item -->

                </div>

            </div>

            <div class="col-lg-6">
                <form asp-action="sendreview" asp-controller="home" method="post" class="myform" data-aos="fade-up" data-aos-delay="200">
                    <div class="row gy-4">

                        <div class="col-md-6">
                            <input type="text" name="Name" id="Name" class="form-control" placeholder="اسمك" required="">
                        </div>

                        <div class="col-md-6 ">
                            <input type="email" class="form-control" name="Email" id="Email" placeholder="ايميلك" required="">
                        </div>

                        <div class="col-12">
                            <input type="text" class="form-control" name="Subject" id="Subject" placeholder="عنوان الرسالة" required="">
                        </div>

                        <div class="col-12">
                            <textarea class="form-control" name="Description" id="Description" rows="6" placeholder="الرسالة" required=""></textarea>
                        </div>
                        @if (User.Identity.IsAuthenticated)
                        {
                        <div class="col-12 text-center">

                            
                            <input type="submit" class="btn btn-primary" value="ارسال" onclick="alert('تم الارسال بنجاح');" />
                        </div>
                              }
                    
                        else
                        {
                            <a asp-area="Identity" asp-page="/Account/Login" class="btn btn-success">
                                <i class="bi bi-plus-circle"></i> ارسال
                            </a>
                        }
                    </div>
                </form>
            </div>

        </div>

    </div>

</section>
@*  ********************************* تواصل معنا  end ********************************* *@ 